!function(){var e={};function t(e,t){var a=function(e,t,a){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return t.get(e)}(e,t,0);return a.get?a.get.call(e):a.value}function a(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var r=new WeakMap,n=new(function(){var e;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),a(this,"movedCells",[]),function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}(this,r),r.set(this,{writable:!0,value:4}),a(this,"initialState",[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),this.initialState=e||Array.from({length:4},function(){return[,,,,].fill(0)}),this.gameState=JSON.parse(JSON.stringify(this.initialState)),this.gameNewState=JSON.parse(JSON.stringify(this.gameState)),this.gameStatus="idle",this.gameScore=0}return e=[{key:"moveLeft",value:function(){var e=this;if("playing"===this.gameStatus){this.resetMovedCells(),this.gameNewState=JSON.parse(JSON.stringify(this.gameState));for(var a=function(t,a,r){if(0!==e.gameNewState[t][r]){var n=!0,i=!1,s=void 0;try{for(var l,o=e.movedCells[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var h=l.value;h.y===t&&h.x===a&&(h.newX=a,h.changed=!0),h.y===t&&h.x===r&&(h.newX=a,h.changed=!0)}}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}e.gameNewState[t][a]*=2,e.gameScore+=e.gameNewState[t][a],e.gameNewState[t][r]=0}},n=0;n<t(this,r);n++)for(var i=0;i<t(this,r)-1;i++)this.gameNewState[n][i]===this.gameNewState[n][i+1]?a(n,i,i+1):i<t(this,r)-2&&this.gameNewState[n][i]===this.gameNewState[n][i+2]&&0===this.gameNewState[n][i+1]?a(n,i,i+2):i<t(this,r)-3&&this.gameNewState[n][i]===this.gameNewState[n][i+3]&&0===this.gameNewState[n][i+1]&&0===this.gameNewState[n][i+2]&&a(n,i,i+3);for(var s=1;s<=t(this,r)-1;s++)for(var l=0;l<t(this,r);l++)for(var o=0;o<t(this,r)-1;o++)if(0===this.gameNewState[l][o]&&0!==this.gameNewState[l][o+1]){var h=!0,c=!1,u=void 0;try{for(var m,g=this.movedCells[Symbol.iterator]();!(h=(m=g.next()).done);h=!0){var f=m.value;f.changed&&f.y===l&&f.newX===o+1&&(f.newX=o),f.changed||f.y!==l||f.x!==o+1||(f.newX=o,f.changed=!0)}}catch(e){c=!0,u=e}finally{try{h||null==g.return||g.return()}finally{if(c)throw u}}this.gameNewState[l][o]=this.gameNewState[l][o+1],this.gameNewState[l][o+1]=0}this.checkChanges(),this.checkStatus()}}},{key:"moveRight",value:function(){var e=this;if("playing"===this.gameStatus){this.resetMovedCells(),this.gameNewState=JSON.parse(JSON.stringify(this.gameState));for(var a=function(t,a,r){if(0!==e.gameNewState[t][r]){var n=!0,i=!1,s=void 0;try{for(var l,o=e.movedCells[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var h=l.value;h.y===t&&h.x===a&&(h.newX=a,h.changed=!0),h.y===t&&h.x===r&&(h.newX=a,h.changed=!0)}}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}e.gameNewState[t][a]*=2,e.gameScore+=e.gameNewState[t][a],e.gameNewState[t][r]=0}},n=t(this,r)-1;n>=0;n--)for(var i=t(this,r)-1;i>0;i--)this.gameNewState[n][i]===this.gameNewState[n][i-1]?a(n,i,i-1):i>1&&this.gameNewState[n][i]===this.gameNewState[n][i-2]&&0===this.gameNewState[n][i-1]?a(n,i,i-2):i>2&&this.gameNewState[n][i]===this.gameNewState[n][i-3]&&0===this.gameNewState[n][i-1]&&0===this.gameNewState[n][i-2]&&a(n,i,i-3);for(var s=1;s<=t(this,r)-1;s++)for(var l=t(this,r)-1;l>=0;l--)for(var o=t(this,r)-1;o>0;o--)if(0===this.gameNewState[l][o]&&0!==this.gameNewState[l][o-1]){var h=!0,c=!1,u=void 0;try{for(var m,g=this.movedCells[Symbol.iterator]();!(h=(m=g.next()).done);h=!0){var f=m.value;f.changed&&f.y===l&&f.newX===o-1&&(f.newX=o),f.changed||f.y!==l||f.x!==o-1||(f.newX=o,f.changed=!0)}}catch(e){c=!0,u=e}finally{try{h||null==g.return||g.return()}finally{if(c)throw u}}this.gameNewState[l][o]=this.gameNewState[l][o-1],this.gameNewState[l][o-1]=0}this.checkChanges(),this.checkStatus()}}},{key:"moveUp",value:function(){var e=this;if("playing"===this.gameStatus){this.resetMovedCells(),this.gameNewState=JSON.parse(JSON.stringify(this.gameState));for(var a=function(t,a,r){if(0!==e.gameNewState[r][a]){var n=!0,i=!1,s=void 0;try{for(var l,o=e.movedCells[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var h=l.value;h.x===a&&h.y===t&&(h.newY=t,h.changed=!0),h.x===a&&h.y===r&&(h.newY=t,h.changed=!0)}}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}e.gameNewState[t][a]*=2,e.gameScore+=e.gameNewState[t][a],e.gameNewState[r][a]=0}},n=0;n<t(this,r);n++)for(var i=0;i<t(this,r)-1;i++)this.gameNewState[i][n]===this.gameNewState[i+1][n]?a(i,n,i+1):i<t(this,r)-2&&this.gameNewState[i][n]===this.gameNewState[i+2][n]&&0===this.gameNewState[i+1][n]?a(i,n,i+2):i<t(this,r)-3&&this.gameNewState[i][n]===this.gameNewState[i+3][n]&&0===this.gameNewState[i+1][n]&&0===this.gameNewState[i+2][n]&&a(i,n,i+3);for(var s=1;s<=t(this,r)-1;s++)for(var l=0;l<t(this,r);l++)for(var o=0;o<t(this,r)-1;o++)if(0===this.gameNewState[o][l]&&0!==this.gameNewState[o+1][l]){var h=!0,c=!1,u=void 0;try{for(var m,g=this.movedCells[Symbol.iterator]();!(h=(m=g.next()).done);h=!0){var f=m.value;f.changed&&f.newY===o+1&&f.x===l&&(f.newY=o),f.changed||f.y!==o+1||f.x!==l||(f.newY=o,f.changed=!0)}}catch(e){c=!0,u=e}finally{try{h||null==g.return||g.return()}finally{if(c)throw u}}this.gameNewState[o][l]=this.gameNewState[o+1][l],this.gameNewState[o+1][l]=0}this.checkChanges(),this.checkStatus()}}},{key:"moveDown",value:function(){var e=this;if("playing"===this.gameStatus){this.resetMovedCells(),this.gameNewState=JSON.parse(JSON.stringify(this.gameState));for(var a=function(t,a,r){if(0!==e.gameNewState[r][a]){var n=!0,i=!1,s=void 0;try{for(var l,o=e.movedCells[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var h=l.value;h.x===a&&h.y===t&&(h.newY=t,h.changed=!0),h.x===a&&h.y===r&&(h.newY=t,h.changed=!0)}}catch(e){i=!0,s=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}e.gameNewState[t][a]*=2,e.gameScore+=e.gameNewState[t][a],e.gameNewState[r][a]=0}},n=t(this,r)-1;n>=0;n--)for(var i=t(this,r)-1;i>0;i--)this.gameNewState[i][n]===this.gameNewState[i-1][n]?a(i,n,i-1):i>1&&this.gameNewState[i][n]===this.gameNewState[i-2][n]&&0===this.gameNewState[i-1][n]?a(i,n,i-2):i>2&&this.gameNewState[i][n]===this.gameNewState[i-3][n]&&0===this.gameNewState[i-1][n]&&0===this.gameNewState[i-2][n]&&a(i,n,i-3);for(var s=1;s<=t(this,r)-1;s++)for(var l=t(this,r)-1;l>=0;l--)for(var o=t(this,r)-1;o>0;o--)if(0===this.gameNewState[o][l]&&0!==this.gameNewState[o-1][l]){var h=!0,c=!1,u=void 0;try{for(var m,g=this.movedCells[Symbol.iterator]();!(h=(m=g.next()).done);h=!0){var f=m.value;f.changed&&f.newY===o-1&&f.x===l&&(f.newY=o),f.changed||f.y!==o-1||f.x!==l||(f.newY=o,f.changed=!0)}}catch(e){c=!0,u=e}finally{try{h||null==g.return||g.return()}finally{if(c)throw u}}this.gameNewState[o][l]=this.gameNewState[o-1][l],this.gameNewState[o-1][l]=0}this.checkChanges(),this.checkStatus()}}},{key:"checkChanges",value:function(){this.movedCells.some(function(e){return e.changed})&&(this.gameState=JSON.parse(JSON.stringify(this.gameNewState)),this.gameNewState=JSON.parse(JSON.stringify(this.gameState)),this.spawnNumber())}},{key:"getScore",value:function(){return this.gameScore}},{key:"getState",value:function(){return this.gameState}},{key:"resetMovedCells",value:function(){this.movedCells=[];for(var e=0;e<t(this,r);e++)for(var a=0;a<t(this,r);a++)0!==this.gameState[e][a]&&this.movedCells.push({x:a,y:e,changed:!1})}},{key:"getMovedCells",value:function(){return this.movedCells}},{key:"getStatus",value:function(){return this.gameStatus}},{key:"start",value:function(){"idle"===this.gameStatus&&(this.gameStatus="playing",this.gameScore=0,this.spawnNumber(),this.spawnNumber())}},{key:"restart",value:function(){this.gameState=JSON.parse(JSON.stringify(this.initialState)),this.gameStatus="idle",this.gameScore=0}},{key:"spawnNumber",value:function(){for(var e=[],a=0;a<t(this,r);a++)for(var n=0;n<t(this,r);n++)0===this.gameState[a][n]&&e.push({x:a,y:n});if(0!==e.length){var i=Math.floor(Math.random()*e.length),s=100*Math.random()+1<=10?4:2;this.gameState[e[i].x][e[i].y]=s}}},{key:"checkStatus",value:function(){this.gameState.some(function(e){return e.includes(2048)})?this.gameStatus="win":this.canMove()||(this.gameStatus="lose")}},{key:"canMove",value:function(){if(this.gameState.some(function(e){return e.includes(0)}))return!0;for(var e=0;e<t(this,r)-1;e++)for(var a=0;a<t(this,r);a++)if(this.gameState[e][a]===this.gameState[e+1][a])return!0;for(var n=0;n<t(this,r);n++)for(var i=0;i<t(this,r)-1;i++)if(this.gameState[n][i]===this.gameState[n][i+1])return!0;return!1}}],function(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,e),n}()),i=document.querySelector("tbody"),s=document.querySelector(".button"),l={duration:200,fill:"forwards",easing:"ease"},o=!1;function h(e){if(e){var t=document.createElement("div");t.classList.add("generated-field"),document.querySelector(".container").prepend(t);return}document.querySelector(".game-score").textContent=n.getScore(),document.querySelector(".generated-field").remove()}function c(){null!==document.querySelector(".generated-field")&&(document.querySelector(".generated-field").innerHTML="");for(var e=document.createDocumentFragment(),t=n.getScore(),a=n.getState(),r=0;r<4;r++)for(var s=0;s<4;s++)if(0!==a[r][s]){var o=i.rows[r].cells[s].getBoundingClientRect();e.append(document.createElement("div")),e.lastElementChild.classList.add("generated-cell","generated-cell--".concat(a[r][s])),e.lastElementChild.dataset.x=s,e.lastElementChild.dataset.y=r,e.lastElementChild.textContent=a[r][s],e.lastElementChild.style.left=o.left+"px",e.lastElementChild.style.top=o.top+"px",e.lastElementChild.animate({transform:["scale(1)","scale(1.03)","scale(1)"]},l)}null!==document.querySelector(".generated-field")&&document.querySelector(".generated-field").append(e),document.querySelector(".game-score").textContent=t}s.addEventListener("click",function(){if(s.classList.contains("start")){o=!0,n.start(),h(!0),c(),document.querySelector(".message-start").classList.add("hidden"),s.classList.remove("start"),s.classList.add("restart"),s.textContent="Restart";return}s.classList.contains("restart")&&(o=!1,n.restart(),h(!1),document.querySelector(".message-start").classList.remove("hidden"),s.classList.remove("restart"),s.classList.add("start"),s.textContent="Start",document.querySelector(".message-win").classList.contains("hidden")||document.querySelector(".message-win").classList.add("hidden"),document.querySelector(".message-lose").classList.contains("hidden")||document.querySelector(".message-lose").classList.add("hidden")),s.blur()}),document.addEventListener("keydown",function(e){o&&("ArrowLeft"===e.key&&n.moveLeft(),"ArrowRight"===e.key&&n.moveRight(),"ArrowUp"===e.key&&n.moveUp(),"ArrowDown"===e.key&&n.moveDown(),function(e){var t=document.querySelector(".generated-field"),a=n.getMovedCells();if(!a.some(function(e){return e.changed}))return!1;var r=!0,s=!1,o=void 0;try{for(var h,c=t.children[Symbol.iterator]();!(r=(h=c.next()).done);r=!0){var u=h.value;u.getAnimations().length>0&&u.getAnimations()[0].cancel()}}catch(e){s=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(s)throw o}}switch(e){case"ArrowLeft":var m=!0,g=!1,f=void 0;try{for(var d,S=t.children[Symbol.iterator]();!(m=(d=S.next()).done);m=!0){var v=d.value,y=v.getBoundingClientRect(),w=0,N=!0,x=!1,p=void 0;try{for(var C,b=a[Symbol.iterator]();!(N=(C=b.next()).done);N=!0){var k=C.value;if(k.changed&&k.x===Number(v.dataset.x)&&k.y===Number(v.dataset.y)){var L=i.rows[k.y].cells[k.newX].getBoundingClientRect();w=y.left-L.left}}}catch(e){x=!0,p=e}finally{try{N||null==b.return||b.return()}finally{if(x)throw p}}v.animate({transform:["translateX(0)","translateX(".concat(-w,"px)")]},l)}}catch(e){g=!0,f=e}finally{try{m||null==S.return||S.return()}finally{if(g)throw f}}break;case"ArrowRight":var O=!0,q=!1,J=void 0;try{for(var X,Y=t.children[Symbol.iterator]();!(O=(X=Y.next()).done);O=!0){var E=X.value,M=E.getBoundingClientRect(),R=0,A=!0,B=!1,D=void 0;try{for(var T,U=a[Symbol.iterator]();!(A=(T=U.next()).done);A=!0){var j=T.value;j.changed&&j.x===Number(E.dataset.x)&&j.y===Number(E.dataset.y)&&(R=i.rows[j.y].cells[j.newX].getBoundingClientRect().left-M.left)}}catch(e){B=!0,D=e}finally{try{A||null==U.return||U.return()}finally{if(B)throw D}}E.animate({transform:["translateX(0)","translateX(".concat(R,"px)")]},l)}}catch(e){q=!0,J=e}finally{try{O||null==Y.return||Y.return()}finally{if(q)throw J}}break;case"ArrowUp":var P=!0,z=!1,F=void 0;try{for(var H,W=t.children[Symbol.iterator]();!(P=(H=W.next()).done);P=!0){var G=H.value,I=G.getBoundingClientRect(),K=0,Q=!0,V=!1,Z=void 0;try{for(var $,_=a[Symbol.iterator]();!(Q=($=_.next()).done);Q=!0){var ee=$.value;if(ee.changed&&ee.x===Number(G.dataset.x)&&ee.y===Number(G.dataset.y)){var et=i.rows[ee.newY].cells[ee.x].getBoundingClientRect();K=I.top-et.top}}}catch(e){V=!0,Z=e}finally{try{Q||null==_.return||_.return()}finally{if(V)throw Z}}G.animate({transform:["translateY(0)","translateY(".concat(-K,"px)")]},l)}}catch(e){z=!0,F=e}finally{try{P||null==W.return||W.return()}finally{if(z)throw F}}break;case"ArrowDown":var ea=!0,er=!1,en=void 0;try{for(var ei,es=t.children[Symbol.iterator]();!(ea=(ei=es.next()).done);ea=!0){var el=ei.value,eo=el.getBoundingClientRect(),eh=0,ec=!0,eu=!1,em=void 0;try{for(var eg,ef=a[Symbol.iterator]();!(ec=(eg=ef.next()).done);ec=!0){var ed=eg.value;ed.changed&&ed.x===Number(el.dataset.x)&&ed.y===Number(el.dataset.y)&&(eh=i.rows[ed.newY].cells[ed.x].getBoundingClientRect().top-eo.top)}}catch(e){eu=!0,em=e}finally{try{ec||null==ef.return||ef.return()}finally{if(eu)throw em}}el.animate({transform:["translateY(0)","translateY(".concat(eh,"px)")]},l)}}catch(e){er=!0,en=e}finally{try{ea||null==es.return||es.return()}finally{if(er)throw en}}}return!0}(e.key)?setTimeout(function(){c()},200):c(),"win"===n.getStatus()&&(document.querySelector(".message-win").classList.remove("hidden"),o=!1),"lose"===n.getStatus()&&(document.querySelector(".message-lose").classList.remove("hidden"),o=!1))})}();
//# sourceMappingURL=index.97d1414b.js.map
