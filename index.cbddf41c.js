var e={};const t=new class{movedCells=[];#e=4;initialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];constructor(e){this.initialState=e||Array.from({length:4},()=>[,,,,].fill(0)),this.gameState=JSON.parse(JSON.stringify(this.initialState)),this.gameNewState=JSON.parse(JSON.stringify(this.gameState)),this.gameStatus="idle",this.gameScore=0}moveLeft(){if("playing"!==this.gameStatus)return;this.resetMovedCells(),this.gameNewState=JSON.parse(JSON.stringify(this.gameState));let e=(e,t,a)=>{if(0!==this.gameNewState[e][a]){for(let s of this.movedCells)s.y===e&&s.x===t&&(s.newX=t,s.changed=!0),s.y===e&&s.x===a&&(s.newX=t,s.changed=!0);this.gameNewState[e][t]*=2,this.gameScore+=this.gameNewState[e][t],this.gameNewState[e][a]=0}};for(let t=0;t<this.#e;t++)for(let a=0;a<this.#e-1;a++)this.gameNewState[t][a]===this.gameNewState[t][a+1]?e(t,a,a+1):a<this.#e-2&&this.gameNewState[t][a]===this.gameNewState[t][a+2]&&0===this.gameNewState[t][a+1]?e(t,a,a+2):a<this.#e-3&&this.gameNewState[t][a]===this.gameNewState[t][a+3]&&0===this.gameNewState[t][a+1]&&0===this.gameNewState[t][a+2]&&e(t,a,a+3);for(let e=1;e<=this.#e-1;e++)for(let e=0;e<this.#e;e++)for(let t=0;t<this.#e-1;t++)if(0===this.gameNewState[e][t]&&0!==this.gameNewState[e][t+1]){for(let a of this.movedCells)a.changed&&a.y===e&&a.newX===t+1&&(a.newX=t),a.changed||a.y!==e||a.x!==t+1||(a.newX=t,a.changed=!0);this.gameNewState[e][t]=this.gameNewState[e][t+1],this.gameNewState[e][t+1]=0}this.checkChanges(),this.checkStatus()}moveRight(){if("playing"!==this.gameStatus)return;this.resetMovedCells(),this.gameNewState=JSON.parse(JSON.stringify(this.gameState));let e=(e,t,a)=>{if(0!==this.gameNewState[e][a]){for(let s of this.movedCells)s.y===e&&s.x===t&&(s.newX=t,s.changed=!0),s.y===e&&s.x===a&&(s.newX=t,s.changed=!0);this.gameNewState[e][t]*=2,this.gameScore+=this.gameNewState[e][t],this.gameNewState[e][a]=0}};for(let t=this.#e-1;t>=0;t--)for(let a=this.#e-1;a>0;a--)this.gameNewState[t][a]===this.gameNewState[t][a-1]?e(t,a,a-1):a>1&&this.gameNewState[t][a]===this.gameNewState[t][a-2]&&0===this.gameNewState[t][a-1]?e(t,a,a-2):a>2&&this.gameNewState[t][a]===this.gameNewState[t][a-3]&&0===this.gameNewState[t][a-1]&&0===this.gameNewState[t][a-2]&&e(t,a,a-3);for(let e=1;e<=this.#e-1;e++)for(let e=this.#e-1;e>=0;e--)for(let t=this.#e-1;t>0;t--)if(0===this.gameNewState[e][t]&&0!==this.gameNewState[e][t-1]){for(let a of this.movedCells)a.changed&&a.y===e&&a.newX===t-1&&(a.newX=t),a.changed||a.y!==e||a.x!==t-1||(a.newX=t,a.changed=!0);this.gameNewState[e][t]=this.gameNewState[e][t-1],this.gameNewState[e][t-1]=0}this.checkChanges(),this.checkStatus()}moveUp(){if("playing"!==this.gameStatus)return;this.resetMovedCells(),this.gameNewState=JSON.parse(JSON.stringify(this.gameState));let e=(e,t,a)=>{if(0!==this.gameNewState[a][t]){for(let s of this.movedCells)s.x===t&&s.y===e&&(s.newY=e,s.changed=!0),s.x===t&&s.y===a&&(s.newY=e,s.changed=!0);this.gameNewState[e][t]*=2,this.gameScore+=this.gameNewState[e][t],this.gameNewState[a][t]=0}};for(let t=0;t<this.#e;t++)for(let a=0;a<this.#e-1;a++)this.gameNewState[a][t]===this.gameNewState[a+1][t]?e(a,t,a+1):a<this.#e-2&&this.gameNewState[a][t]===this.gameNewState[a+2][t]&&0===this.gameNewState[a+1][t]?e(a,t,a+2):a<this.#e-3&&this.gameNewState[a][t]===this.gameNewState[a+3][t]&&0===this.gameNewState[a+1][t]&&0===this.gameNewState[a+2][t]&&e(a,t,a+3);for(let e=1;e<=this.#e-1;e++)for(let e=0;e<this.#e;e++)for(let t=0;t<this.#e-1;t++)if(0===this.gameNewState[t][e]&&0!==this.gameNewState[t+1][e]){for(let a of this.movedCells)a.changed&&a.newY===t+1&&a.x===e&&(a.newY=t),a.changed||a.y!==t+1||a.x!==e||(a.newY=t,a.changed=!0);this.gameNewState[t][e]=this.gameNewState[t+1][e],this.gameNewState[t+1][e]=0}this.checkChanges(),this.checkStatus()}moveDown(){if("playing"!==this.gameStatus)return;this.resetMovedCells(),this.gameNewState=JSON.parse(JSON.stringify(this.gameState));let e=(e,t,a)=>{if(0!==this.gameNewState[a][t]){for(let s of this.movedCells)s.x===t&&s.y===e&&(s.newY=e,s.changed=!0),s.x===t&&s.y===a&&(s.newY=e,s.changed=!0);this.gameNewState[e][t]*=2,this.gameScore+=this.gameNewState[e][t],this.gameNewState[a][t]=0}};for(let t=this.#e-1;t>=0;t--)for(let a=this.#e-1;a>0;a--)this.gameNewState[a][t]===this.gameNewState[a-1][t]?e(a,t,a-1):a>1&&this.gameNewState[a][t]===this.gameNewState[a-2][t]&&0===this.gameNewState[a-1][t]?e(a,t,a-2):a>2&&this.gameNewState[a][t]===this.gameNewState[a-3][t]&&0===this.gameNewState[a-1][t]&&0===this.gameNewState[a-2][t]&&e(a,t,a-3);for(let e=1;e<=this.#e-1;e++)for(let e=this.#e-1;e>=0;e--)for(let t=this.#e-1;t>0;t--)if(0===this.gameNewState[t][e]&&0!==this.gameNewState[t-1][e]){for(let a of this.movedCells)a.changed&&a.newY===t-1&&a.x===e&&(a.newY=t),a.changed||a.y!==t-1||a.x!==e||(a.newY=t,a.changed=!0);this.gameNewState[t][e]=this.gameNewState[t-1][e],this.gameNewState[t-1][e]=0}this.checkChanges(),this.checkStatus()}checkChanges(){this.movedCells.some(e=>e.changed)&&(this.gameState=JSON.parse(JSON.stringify(this.gameNewState)),this.gameNewState=JSON.parse(JSON.stringify(this.gameState)),this.spawnNumber())}getScore(){return this.gameScore}getState(){return this.gameState}resetMovedCells(){this.movedCells=[];for(let e=0;e<this.#e;e++)for(let t=0;t<this.#e;t++)0!==this.gameState[e][t]&&this.movedCells.push({x:t,y:e,changed:!1})}getMovedCells(){return this.movedCells}getStatus(){return this.gameStatus}start(){"idle"===this.gameStatus&&(this.gameStatus="playing",this.gameScore=0,this.spawnNumber(),this.spawnNumber())}restart(){this.gameState=JSON.parse(JSON.stringify(this.initialState)),this.gameStatus="idle",this.gameScore=0}spawnNumber(){let e=[];for(let t=0;t<this.#e;t++)for(let a=0;a<this.#e;a++)0===this.gameState[t][a]&&e.push({x:t,y:a});if(0===e.length)return;let t=Math.floor(Math.random()*e.length),a=100*Math.random()+1<=10?4:2;this.gameState[e[t].x][e[t].y]=a}checkStatus(){this.gameState.some(e=>e.includes(2048))?this.gameStatus="win":this.canMove()||(this.gameStatus="lose")}canMove(){if(this.gameState.some(e=>e.includes(0)))return!0;for(let e=0;e<this.#e-1;e++)for(let t=0;t<this.#e;t++)if(this.gameState[e][t]===this.gameState[e+1][t])return!0;for(let e=0;e<this.#e;e++)for(let t=0;t<this.#e-1;t++)if(this.gameState[e][t]===this.gameState[e][t+1])return!0;return!1}},a=document.querySelector("tbody"),s=document.querySelector(".button"),i={duration:200,fill:"forwards",easing:"ease"};let r=!1;function n(e){if(e){let e=document.createElement("div");e.classList.add("generated-field"),document.querySelector(".container").prepend(e);return}document.querySelector(".game-score").textContent=t.getScore(),document.querySelector(".generated-field").remove()}function h(){null!==document.querySelector(".generated-field")&&(document.querySelector(".generated-field").innerHTML="");let e=document.createDocumentFragment(),s=t.getScore(),r=t.getState();for(let t=0;t<4;t++)for(let s=0;s<4;s++)if(0!==r[t][s]){let n=a.rows[t].cells[s].getBoundingClientRect();e.append(document.createElement("div")),e.lastElementChild.classList.add("generated-cell",`generated-cell--${r[t][s]}`),e.lastElementChild.dataset.x=s,e.lastElementChild.dataset.y=t,e.lastElementChild.textContent=r[t][s],e.lastElementChild.style.left=n.left+"px",e.lastElementChild.style.top=n.top+"px",e.lastElementChild.animate({transform:["scale(1)","scale(1.03)","scale(1)"]},i)}null!==document.querySelector(".generated-field")&&document.querySelector(".generated-field").append(e),document.querySelector(".game-score").textContent=s}s.addEventListener("click",()=>{if(s.classList.contains("start")){r=!0,t.start(),n(!0),h(),document.querySelector(".message-start").classList.add("hidden"),s.classList.remove("start"),s.classList.add("restart"),s.textContent="Restart";return}s.classList.contains("restart")&&(r=!1,t.restart(),n(!1),document.querySelector(".message-start").classList.remove("hidden"),s.classList.remove("restart"),s.classList.add("start"),s.textContent="Start",document.querySelector(".message-win").classList.contains("hidden")||document.querySelector(".message-win").classList.add("hidden"),document.querySelector(".message-lose").classList.contains("hidden")||document.querySelector(".message-lose").classList.add("hidden")),s.blur()}),document.addEventListener("keydown",e=>{r&&("ArrowLeft"===e.key&&t.moveLeft(),"ArrowRight"===e.key&&t.moveRight(),"ArrowUp"===e.key&&t.moveUp(),"ArrowDown"===e.key&&t.moveDown(),function(e){let s=document.querySelector(".generated-field"),r=t.getMovedCells();if(!r.some(e=>e.changed))return!1;for(let e of s.children)e.getAnimations().length>0&&e.getAnimations()[0].cancel();switch(e){case"ArrowLeft":for(let e of s.children){let t=e.getBoundingClientRect(),s=0;for(let i of r)if(i.changed&&i.x===Number(e.dataset.x)&&i.y===Number(e.dataset.y)){let e=a.rows[i.y].cells[i.newX].getBoundingClientRect();s=t.left-e.left}e.animate({transform:["translateX(0)",`translateX(${-s}px)`]},i)}break;case"ArrowRight":for(let e of s.children){let t=e.getBoundingClientRect(),s=0;for(let i of r)i.changed&&i.x===Number(e.dataset.x)&&i.y===Number(e.dataset.y)&&(s=a.rows[i.y].cells[i.newX].getBoundingClientRect().left-t.left);e.animate({transform:["translateX(0)",`translateX(${s}px)`]},i)}break;case"ArrowUp":for(let e of s.children){let t=e.getBoundingClientRect(),s=0;for(let i of r)if(i.changed&&i.x===Number(e.dataset.x)&&i.y===Number(e.dataset.y)){let e=a.rows[i.newY].cells[i.x].getBoundingClientRect();s=t.top-e.top}e.animate({transform:["translateY(0)",`translateY(${-s}px)`]},i)}break;case"ArrowDown":for(let e of s.children){let t=e.getBoundingClientRect(),s=0;for(let i of r)i.changed&&i.x===Number(e.dataset.x)&&i.y===Number(e.dataset.y)&&(s=a.rows[i.newY].cells[i.x].getBoundingClientRect().top-t.top);e.animate({transform:["translateY(0)",`translateY(${s}px)`]},i)}}return!0}(e.key)?setTimeout(()=>{h()},200):h(),"win"===t.getStatus()&&(document.querySelector(".message-win").classList.remove("hidden"),r=!1),"lose"===t.getStatus()&&(document.querySelector(".message-lose").classList.remove("hidden"),r=!1))});
//# sourceMappingURL=index.cbddf41c.js.map
